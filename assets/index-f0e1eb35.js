(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))u(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&u(d)}).observe(document,{childList:!0,subtree:!0});function c(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerpolicy&&(l.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?l.credentials="include":i.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function u(i){if(i.ep)return;i.ep=!0;const l=c(i);fetch(i.href,l)}})();function se(o){if(o.__esModule)return o;var a=o.default;if(typeof a=="function"){var c=function u(){if(this instanceof u){var i=[null];i.push.apply(i,arguments);var l=Function.bind.apply(a,i);return new l}return a.apply(this,arguments)};c.prototype=a.prototype}else c={};return Object.defineProperty(c,"__esModule",{value:!0}),Object.keys(o).forEach(function(u){var i=Object.getOwnPropertyDescriptor(o,u);Object.defineProperty(c,u,i.get?i:{enumerable:!0,get:function(){return o[u]}})}),c}var X={},ce={get exports(){return X},set exports(o){X=o}};(function(o){var a=function(c){var u=Object.prototype,i=u.hasOwnProperty,l=Object.defineProperty||function(t,e,r){t[e]=r.value},d,v=typeof Symbol=="function"?Symbol:{},h=v.iterator||"@@iterator",E=v.asyncIterator||"@@asyncIterator",O=v.toStringTag||"@@toStringTag";function b(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{b({},"")}catch{b=function(e,r,f){return e[r]=f}}function W(t,e,r,f){var n=e&&e.prototype instanceof G?e:G,p=Object.create(n.prototype),L=new g(f||[]);return l(p,"_invoke",{value:K(t,r,L)}),p}c.wrap=W;function k(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(f){return{type:"throw",arg:f}}}var $="suspendedStart",q="suspendedYield",C="executing",U="completed",w={};function G(){}function M(){}function R(){}var z={};b(z,h,function(){return this});var H=Object.getPrototypeOf,I=H&&H(H(y([])));I&&I!==u&&i.call(I,h)&&(z=I);var _=R.prototype=G.prototype=Object.create(z);M.prototype=R,l(_,"constructor",{value:R,configurable:!0}),l(R,"constructor",{value:M,configurable:!0}),M.displayName=b(R,O,"GeneratorFunction");function x(t){["next","throw","return"].forEach(function(e){b(t,e,function(r){return this._invoke(e,r)})})}c.isGeneratorFunction=function(t){var e=typeof t=="function"&&t.constructor;return e?e===M||(e.displayName||e.name)==="GeneratorFunction":!1},c.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,R):(t.__proto__=R,b(t,O,"GeneratorFunction")),t.prototype=Object.create(_),t},c.awrap=function(t){return{__await:t}};function B(t,e){function r(p,L,j,P){var S=k(t[p],t,L);if(S.type==="throw")P(S.arg);else{var V=S.arg,Y=V.value;return Y&&typeof Y=="object"&&i.call(Y,"__await")?e.resolve(Y.__await).then(function(A){r("next",A,j,P)},function(A){r("throw",A,j,P)}):e.resolve(Y).then(function(A){V.value=A,j(V)},function(A){return r("throw",A,j,P)})}}var f;function n(p,L){function j(){return new e(function(P,S){r(p,L,P,S)})}return f=f?f.then(j,j):j()}l(this,"_invoke",{value:n})}x(B.prototype),b(B.prototype,E,function(){return this}),c.AsyncIterator=B,c.async=function(t,e,r,f,n){n===void 0&&(n=Promise);var p=new B(W(t,e,r,f),n);return c.isGeneratorFunction(e)?p:p.next().then(function(L){return L.done?L.value:p.next()})};function K(t,e,r){var f=$;return function(p,L){if(f===C)throw new Error("Generator is already running");if(f===U){if(p==="throw")throw L;return F()}for(r.method=p,r.arg=L;;){var j=r.delegate;if(j){var P=J(j,r);if(P){if(P===w)continue;return P}}if(r.method==="next")r.sent=r._sent=r.arg;else if(r.method==="throw"){if(f===$)throw f=U,r.arg;r.dispatchException(r.arg)}else r.method==="return"&&r.abrupt("return",r.arg);f=C;var S=k(t,e,r);if(S.type==="normal"){if(f=r.done?U:q,S.arg===w)continue;return{value:S.arg,done:r.done}}else S.type==="throw"&&(f=U,r.method="throw",r.arg=S.arg)}}}function J(t,e){var r=e.method,f=t.iterator[r];if(f===d)return e.delegate=null,r==="throw"&&t.iterator.return&&(e.method="return",e.arg=d,J(t,e),e.method==="throw")||r!=="return"&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),w;var n=k(f,t.iterator,e.arg);if(n.type==="throw")return e.method="throw",e.arg=n.arg,e.delegate=null,w;var p=n.arg;if(!p)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,w;if(p.done)e[t.resultName]=p.value,e.next=t.nextLoc,e.method!=="return"&&(e.method="next",e.arg=d);else return p;return e.delegate=null,w}x(_),b(_,O,"Generator"),b(_,h,function(){return this}),b(_,"toString",function(){return"[object Generator]"});function s(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function m(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function g(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(s,this),this.reset(!0)}c.keys=function(t){var e=Object(t),r=[];for(var f in e)r.push(f);return r.reverse(),function n(){for(;r.length;){var p=r.pop();if(p in e)return n.value=p,n.done=!1,n}return n.done=!0,n}};function y(t){if(t){var e=t[h];if(e)return e.call(t);if(typeof t.next=="function")return t;if(!isNaN(t.length)){var r=-1,f=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=d,n.done=!0,n};return f.next=f}}return{next:F}}c.values=y;function F(){return{value:d,done:!0}}return g.prototype={constructor:g,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=d,this.done=!1,this.delegate=null,this.method="next",this.arg=d,this.tryEntries.forEach(m),!t)for(var e in this)e.charAt(0)==="t"&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=d)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(P,S){return p.type="throw",p.arg=t,e.next=P,S&&(e.method="next",e.arg=d),!!S}for(var f=this.tryEntries.length-1;f>=0;--f){var n=this.tryEntries[f],p=n.completion;if(n.tryLoc==="root")return r("end");if(n.tryLoc<=this.prev){var L=i.call(n,"catchLoc"),j=i.call(n,"finallyLoc");if(L&&j){if(this.prev<n.catchLoc)return r(n.catchLoc,!0);if(this.prev<n.finallyLoc)return r(n.finallyLoc)}else if(L){if(this.prev<n.catchLoc)return r(n.catchLoc,!0)}else if(j){if(this.prev<n.finallyLoc)return r(n.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var f=this.tryEntries[r];if(f.tryLoc<=this.prev&&i.call(f,"finallyLoc")&&this.prev<f.finallyLoc){var n=f;break}}n&&(t==="break"||t==="continue")&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var p=n?n.completion:{};return p.type=t,p.arg=e,n?(this.method="next",this.next=n.finallyLoc,w):this.complete(p)},complete:function(t,e){if(t.type==="throw")throw t.arg;return t.type==="break"||t.type==="continue"?this.next=t.arg:t.type==="return"?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):t.type==="normal"&&e&&(this.next=e),w},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),m(r),w}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var f=r.completion;if(f.type==="throw"){var n=f.arg;m(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:y(t),resultName:e,nextLoc:r},this.method==="next"&&(this.arg=d),w}},c}(o.exports);try{regeneratorRuntime=a}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=a:Function("r","regeneratorRuntime = r")(a)}})(ce);var fe={defaultArgs:["./ffmpeg","-nostdin","-y"],baseOptions:{log:!1,logger:()=>{},progress:()=>{},corePath:""}},le=(o,a)=>{const c=o._malloc(a.length*Uint32Array.BYTES_PER_ELEMENT);return a.forEach((u,i)=>{const l=o.lengthBytesUTF8(u)+1,d=o._malloc(l);o.stringToUTF8(u,d,l),o.setValue(c+Uint32Array.BYTES_PER_ELEMENT*i,d,"i32")}),[a.length,c]};const ue="@ffmpeg/ffmpeg",pe="0.11.6",de="FFmpeg WebAssembly version",me="src/index.js",he="src/index.d.ts",ge={example:"examples"},we={start:"node scripts/server.js","start:worker":"node scripts/worker-server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js","build:worker":"rimraf dist && webpack --config scripts/webpack.config.worker.prod.js",prepublishOnly:"npm run build",lint:"eslint src",wait:"rimraf dist && wait-on http://localhost:3000/dist/ffmpeg.dev.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:ffmpeg test:node:all","test:node":"node node_modules/mocha/bin/_mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser":"mocha-headless-chrome -a allow-file-access-from-files -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:ffmpeg":"npm run test:browser -- -f ./tests/ffmpeg.test.html"},ye={"./src/node/index.js":"./src/browser/index.js"},ve={type:"git",url:"git+https://github.com/ffmpegwasm/ffmpeg.wasm.git"},be=["ffmpeg","WebAssembly","video"],Fe="Jerome Wu <jeromewus@gmail.com>",Ee="MIT",Le={url:"https://github.com/ffmpegwasm/ffmpeg.wasm/issues"},je={node:">=12.16.1"},Se="https://github.com/ffmpegwasm/ffmpeg.wasm#readme",Oe={"is-url":"^1.2.4","node-fetch":"^2.6.1","regenerator-runtime":"^0.13.7","resolve-url":"^0.2.1"},Pe={"@babel/core":"^7.12.3","@babel/preset-env":"^7.12.1","@ffmpeg/core":"^0.11.0","@types/emscripten":"^1.39.4","babel-eslint":"^10.1.0","babel-loader":"^8.1.0",chai:"^4.2.0",cors:"^2.8.5",eslint:"^7.12.1","eslint-config-airbnb-base":"^14.1.0","eslint-plugin-import":"^2.22.1",express:"^4.17.1",mocha:"^8.2.1","mocha-headless-chrome":"^2.0.3","npm-run-all":"^4.1.5","wait-on":"^5.3.0",webpack:"^5.3.2","webpack-cli":"^4.1.0","webpack-dev-middleware":"^4.0.0"},ne={name:ue,version:pe,description:de,main:me,types:he,directories:ge,scripts:we,browser:ye,repository:ve,keywords:be,author:Fe,license:Ee,bugs:Le,engines:je,homepage:Se,dependencies:Oe,devDependencies:Pe},ke=(typeof process<"u",`https://unpkg.com/@ffmpeg/core@${ne.devDependencies["@ffmpeg/core"].substring(1)}/dist/ffmpeg-core.js`),Re={corePath:ke};let Q=!1,ie=()=>{};const Te=o=>{Q=o},_e=o=>{ie=o},$e=(o,a)=>{ie({type:o,message:a}),Q&&console.log(`[${o}] ${a}`)};var N={logging:Q,setLogging:Te,setCustomLogger:_e,log:$e};const Ce=o=>`
createFFmpegCore is not defined. ffmpeg.wasm is unable to find createFFmpegCore after loading ffmpeg-core.js from ${o}. Use another URL when calling createFFmpeg():

const ffmpeg = createFFmpeg({
  corePath: 'http://localhost:3000/ffmpeg-core.js',
});
`;var ee={CREATE_FFMPEG_CORE_IS_NOT_DEFINED:Ce};const D=async(o,a)=>{N.log("info",`fetch ${o}`);const c=await(await fetch(o)).arrayBuffer();N.log("info",`${o} file size = ${c.byteLength} bytes`);const u=new Blob([c],{type:a}),i=URL.createObjectURL(u);return N.log("info",`${o} blob URL = ${i}`),i},Ae=async({corePath:o,workerPath:a,wasmPath:c})=>{if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope){if(typeof o!="string")throw Error("corePath should be a string!");const v=new URL(o,import.meta.url).href,h=await D(v,"application/javascript"),E=await D(c!==void 0?c:v.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),O=await D(a!==void 0?a:v.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore>"u"?new Promise(b=>{if(globalThis.importScripts(h),typeof createFFmpegCore>"u")throw Error(ee.CREATE_FFMPEG_CORE_IS_NOT_DEFINED(v));N.log("info","ffmpeg-core.js script loaded"),b({createFFmpegCore,corePath:h,wasmPath:E,workerPath:O})}):(N.log("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:h,wasmPath:E,workerPath:O}))}if(typeof o!="string")throw Error("corePath should be a string!");const u=new URL(o,import.meta.url).href,i=await D(u,"application/javascript"),l=await D(c!==void 0?c:u.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),d=await D(a!==void 0?a:u.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore>"u"?new Promise(v=>{const h=document.createElement("script"),E=()=>{if(h.removeEventListener("load",E),typeof createFFmpegCore>"u")throw Error(ee.CREATE_FFMPEG_CORE_IS_NOT_DEFINED(u));N.log("info","ffmpeg-core.js script loaded"),v({createFFmpegCore,corePath:i,wasmPath:l,workerPath:d})};h.src=i,h.type="text/javascript",h.addEventListener("load",E),document.getElementsByTagName("head")[0].appendChild(h)}):(N.log("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:i,wasmPath:l,workerPath:d}))},Ne=o=>new Promise((a,c)=>{const u=new FileReader;u.onload=()=>{a(u.result)},u.onerror=({target:{error:{code:i}}})=>{c(Error(`File could not be read! Code=${i}`))},u.readAsArrayBuffer(o)}),Ue=async o=>{let a=o;return typeof o>"u"?new Uint8Array:(typeof o=="string"?/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(o)?a=atob(o.split(",")[1]).split("").map(c=>c.charCodeAt(0)):a=await(await fetch(new URL(o,import.meta.url).href)).arrayBuffer():(o instanceof File||o instanceof Blob)&&(a=await Ne(o)),new Uint8Array(a))},Ge=Object.freeze(Object.defineProperty({__proto__:null,defaultOptions:Re,fetchFile:Ue,getCreateFFmpegCore:Ae},Symbol.toStringTag,{value:"Module"})),ae=se(Ge),{defaultArgs:Me,baseOptions:Ie}=fe,Be=le,{defaultOptions:De,getCreateFFmpegCore:We}=ae,{version:qe}=ne,Z=Error("ffmpeg.wasm is not ready, make sure you have completed load().");var ze=(o={})=>{const{log:a,logger:c,progress:u,...i}={...Ie,...De,...o};let l=null,d=null,v=null,h=null,E=!1,O=()=>{},b=a,W=u,k=0,$=0,q=!1,C=0;const U=s=>{s==="FFMPEG_END"&&v!==null&&(v(),v=null,h=null,E=!1)},w=(s,m)=>{O({type:s,message:m}),b&&console.log(`[${s}] ${m}`)},G=s=>{const[m,g,y]=s.split(":");return parseFloat(m)*60*60+parseFloat(g)*60+parseFloat(y)},M=(s,m)=>{if(typeof s=="string")if(s.startsWith("  Duration")){const g=s.split(", ")[0].split(": ")[1],y=G(g);m({duration:y,ratio:C}),(k===0||k>y)&&(k=y,q=!0)}else if(q&&s.startsWith("    Stream")){const g=s.match(/([\d.]+) fps/);if(g){const y=parseFloat(g[1]);$=k*y}else $=0;q=!1}else if(s.startsWith("frame")||s.startsWith("size")){const g=s.split("time=")[1].split(" ")[0],y=G(g),F=s.match(/frame=\s*(\d+)/);if($&&F){const t=parseFloat(F[1]);C=Math.min(t/$,1)}else C=y/k;m({ratio:C,time:y})}else s.startsWith("video:")&&(m({ratio:1}),k=0)},R=({type:s,message:m})=>{w(s,m),M(m,W),U(m)},z=async()=>{if(w("info","load ffmpeg-core"),l===null){w("info","loading ffmpeg-core");const{createFFmpegCore:s,corePath:m,workerPath:g,wasmPath:y}=await We(i);l=await s({mainScriptUrlOrBlob:m,printErr:F=>R({type:"fferr",message:F}),print:F=>R({type:"ffout",message:F}),locateFile:(F,t)=>{if(typeof window<"u"||typeof WorkerGlobalScope<"u"){if(typeof y<"u"&&F.endsWith("ffmpeg-core.wasm"))return y;if(typeof g<"u"&&F.endsWith("ffmpeg-core.worker.js"))return g}return t+F}}),d=l.cwrap(i.mainName||"proxy_main","number",["number","number"]),w("info","ffmpeg-core loaded")}else throw Error("ffmpeg.wasm was loaded, you should not load it again, use ffmpeg.isLoaded() to check next time.")},H=()=>l!==null,I=(...s)=>{if(w("info",`run ffmpeg command: ${s.join(" ")}`),l===null)throw Z;if(E)throw Error("ffmpeg.wasm can only run one command at a time");return E=!0,new Promise((m,g)=>{const y=[...Me,...s].filter(F=>F.length!==0);v=m,h=g,d(...Be(l,y))})},_=(s,...m)=>{if(w("info",`run FS.${s} ${m.map(g=>typeof g=="string"?g:`<${g.length} bytes binary file>`).join(" ")}`),l===null)throw Z;{let g=null;try{g=l.FS[s](...m)}catch{throw Error(s==="readdir"?`ffmpeg.FS('readdir', '${m[0]}') error. Check if the path exists, ex: ffmpeg.FS('readdir', '/')`:s==="readFile"?`ffmpeg.FS('readFile', '${m[0]}') error. Check if the path exists`:"Oops, something went wrong in FS operation.")}return g}},x=()=>{if(l===null)throw Z;h&&h("ffmpeg has exited"),E=!1;try{l.exit(1)}catch(s){w(s.message),h&&h(s)}finally{l=null,d=null,v=null,h=null}},B=s=>{W=s},K=s=>{O=s},J=s=>{b=s};return w("info",`use ffmpeg.wasm v${qe}`),{setProgress:B,setLogger:K,setLogging:J,load:z,isLoaded:H,run:I,exit:x,FS:_}};const He=ze,{fetchFile:Ye}=ae;var te={createFFmpeg:He,fetchFile:Ye};const re=30,oe=1;let T=null;const xe=async o=>{T===null&&(T=te.createFFmpeg({log:!0}));const a=document.getElementById("message"),u=o.currentTarget.files[0],{name:i}=u,l=await Ke(u);console.log(l),a.innerHTML="Loading ffmpeg-core.js",T.isLoaded()||await T.load(),T.FS("writeFile",i,await te.fetchFile(u)),a.innerHTML="Start transcoding",await T.run("-i",i,"-t",oe.toString(),"-r",re.toString(),"-f","image2","frames%d.png"),a.innerHTML="Start Getting Audio",await T.run("-i",i,"-vn","-acodec","copy","audio.aac"),a.innerHTML="Complete transcoding";const d=T.FS("readFile","frames20.png"),v=new Array().fill(null);for(let b=0;b<oe*re;b++)v.push(T.FS("readFile",`frames${b+1}.png`));console.log(v);const h=T.FS("readFile","audio.aac"),E=document.getElementById("output-img");E.src=URL.createObjectURL(new Blob([d.buffer]));const O=document.getElementById("audio-player");O.src=URL.createObjectURL(new Blob([h.buffer])),O.currentTime=0,O.play()},Je=document.getElementById("uploader");Je.addEventListener("change",xe);async function Ke(o){const a=document.createElement("video");return a.preload="metadata",a.src=URL.createObjectURL(o),new Promise(c=>{a.onloadedmetadata=()=>{window.URL.revokeObjectURL(a.src),c(Math.round(a.duration))}})}
